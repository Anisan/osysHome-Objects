{% extends "admin.html" %}
{% from "macros/code_editor.html" import render_editor %}

{% block title %} Class {% endblock %} 

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="Objects">Objects</a></li>
<li class="breadcrumb-item"><a href="Objects?view=class&class={{id}}">{{form.name.data}}</a></li>
{% endblock %}

{% block module_content %}

{% if form.errors %}
<div class="alert alert-warning mt-3">
    <ul>
    {% for field, errors in form.errors.items() %}
        {% for error in errors %}
            <li>{{field}}: {{ error }}</li>
        {% endfor %}
    {% endfor %}
    </ul>
</div>
{% endif %}
<style>
    /* Используем flexbox для выравнивания вкладок */
    .nav-tabs {
      display: flex;
    }
    /* Добавляем маржин слева для первых вкладок, чтобы их выровнять по правому краю */
    .nav-item:not(:last-child) {
      margin-right: auto;
    }
</style>

<ul class="nav nav-tabs" id="configTabs" role="tablist">
    <li class="nav-item">
        <a class="nav-link tab-button {% if tab == ''%}active{%endif%}" href="#general" data-bs-toggle="tab" role="tab">General</a>
    </li>
    <li class="nav-item">
        <button class="nav-link tab-button{% if tab == 'properties'%} active{%endif%}{% if not id %} disabled{%endif%}" href="#properties" data-bs-toggle="tab" role="tab">
            Properties <a href="?view=property&class={{id}}" class="btn btn-success btn-sm ms-2"><i class="fas fa-plus"></i></a>
        </button>
    </li>
    <li class="nav-item">
        <button class="nav-link tab-button{% if tab == 'methods'%} active{%endif%}{% if not id %} disabled{%endif%}" href="#methods" data-bs-toggle="tab" role="tab">
            Methods <a href="?view=method&class={{id}}" class="btn btn-success btn-sm ms-2"><i class="fas fa-plus"></i></a>
        </a>
    </li>
    <li class="nav-item">
        <button class="nav-link tab-button{% if tab == 'objects'%} active{%endif%}{% if not id %} disabled{%endif%}" href="#objects" data-bs-toggle="tab" role="tab">
            Objects <a href="?view=object&class={{id}}" class="btn btn-success btn-sm ms-2"><i class="fas fa-plus"></i></a>
        </a>
    </li>
    <li class="nav-item"><a class="nav-link tab-button{% if tab == 'template'%} active{%endif%}{% if not id %} disabled{%endif%}" href="#template_tab" data-bs-toggle="tab" role="tab">Template</a></li>
    <li class="nav-item flex-grow-1"> <!-- flex-grow-1 для заполнения промежутка -->
        <!-- Пустой элемент, чтобы создать промежуток -->
      </li>
    <li class="nav-item ml-auto"> <!-- Используем ml-auto для выравнивания последней вкладки справа -->
        <a class="nav-link tab-button" data-bs-toggle="tab" href="#tools">Tools</a>
    </li>
</ul>
<div class="tab-content mt-3" id="myTabContent">
    <div class="tab-pane fade {% if tab == ''%}show active{%endif%}" id="general" role="tabpanel" aria-labelledby="general-tab">
        <form method="POST">
            <!-- Поля формы -->
            {{ form.hidden_tag() }}
            <div class="mb-3">
                {{ form.name.label(class="form-label") }}
                {{ form.name(class="form-control") }}
            </div>
            <div class="mb-3">
                {{ form.description.label(class="form-label") }}
                {{ form.description(class="form-control") }}
            </div>
            <div class="mb-3">
                {{ form.parent_id.label(class="form-label") }}
                {{ form.parent_id(class="form-control") }}
            </div>
            <!-- Кнопка отправки формы -->
            <button type="submit" class="btn btn-primary">Submit</button>
            <a href="Objects" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
    <div class="tab-pane fade {% if tab == 'properties'%}show active{%endif%}" id="properties" role="tabpanel" aria-labelledby="properties-tab">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Description</th>
                        <th>History</th>
                        <th>Type</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for property in properties %}
                    <tr>
                        <th scope="row">{{ property.id }}</th>
                        <td>{{ property.name }}</td>
                        <td>{{ property.description }}
                            {%if property.method%}<p style="color: gray;margin: 0px;">↳ <span class="badge bg-primary">Method: {{property.method}}</span></p>{%endif%}
                        </td>
                        <td>{{ property.history }}</td>
                        <td>{{ property.type }}</td>
                        <td>
                            <a href="?view=property&class={{id}}&property={{property.id}}&op=edit" class="btn btn-success btn-sm" role="button"><i class="fas fa-pencil-alt"></i></a>
                            <a href="?view=property&class={{id}}&property={{property.id}}&op=delete" onClick="return confirm('Delete record?')" class="btn btn-danger btn-sm" role="button"><i class="fas fa-trash"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                    {% if parent_properties %}
                    <tr>
                        <td colspan="5"><b>Parent properties</b></td>
                    </tr>
                    {% endif %}
                    {% for property in parent_properties %}
                    <tr>
                        <th scope="row">{{ property.id }}</th>
                        <td><b>{{ property.name }}</b></td>
                        <td>{{ property.description }}
                            {%if property.method%}<p style="color: gray;margin: 0px;">↳ <span class="badge bg-primary">Method: {{property.method}}</span></p>{%endif%}
                        </td>
                        <td>{{ property.history }}</td>
                        <td>{{ property.type }}</td>
                        <td>
                            <a href="?view=property&class={{id}}&property={{property.id}}&op=redefine" class="btn btn-info btn-sm" role="button">Redefine</a>
                        </td>
                    </tr>
                    {% endfor %}

                </tbody>
            </table>
        </div>
        <a href="Objects" class="btn btn-secondary">Cancel</a>
    </div>
    <div class="tab-pane fade {% if tab == 'methods'%}show active{%endif%}" id="methods" role="tabpanel" aria-labelledby="methods-tab">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Description</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for method in methods %}
                    <tr>
                        <th scope="row">{{ method.id }}</th>
                        <td>{{ method.name }}</td>
                        <td>{{ method.description }}</td>
                        <td>
                            <a href="?view=method&class={{id}}&method={{method.id}}&op=edit" class="btn btn-success btn-sm" role="button"><i class="fas fa-pencil-alt"></i></a>
                            <a href="?view=method&class={{id}}&method={{method.id}}&op=delete" onClick="return confirm('Delete record?')" class="btn btn-danger btn-sm" role="button"><i class="fas fa-trash"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                    {% if parent_methods %}
                    <tr>
                        <td colspan="5"><b>Parent methods</b></td>
                    </tr>
                    {% endif %}
                    {% for method in parent_methods %}
                    <tr>
                        <th scope="row">{{ method.id }}</th>
                        <td><b>{{ method.name }}</b></td>
                        <td>{{ method.description }}</td>
                        <td>
                            {% set has_method = False %}
                            {% for m in methods %}
                                {% if m.name == method.name %}
                                    {% set has_method = True %}
                                {% endif %}
                            {% endfor %}

                            {% if not has_method %}
                            <a href="?view=method&class={{id}}&method={{method.id}}&op=redefine" class="btn btn-info btn-sm" role="button">Redefine</a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <a href="Objects" class="btn btn-secondary">Cancel</a>
    </div>
    <div class="tab-pane fade {% if tab == 'objects'%}show active{%endif%}" id="objects" role="tabpanel" aria-labelledby="objects-tab">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>Description</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for object in objects %}
                    <tr>
                        <th scope="row">{{ object.id }}</th>
                        <td>{{ object.name }}</td>
                        <td>{{ object.description }}</td>
                        <td>
                            <a href="?view=object&object={{object.id}}&op=edit" class="btn btn-success btn-sm" role="button"><i class="fas fa-pencil-alt"></i></a>
                            <a href="?view=object&object={{object.id}}&op=delete" onClick="return confirm('Delete record?')" class="btn btn-danger btn-sm" role="button"><i class="fas fa-trash"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <a href="Objects" class="btn btn-secondary">Cancel</a>
    </div>
    <div class="tab-pane fade {% if tab == 'template'%}show active{%endif%}" id="template_tab" role="tabpanel" aria-labelledby="template-tab">
        <form id="formTemplate" method="POST">
            <!-- Поля формы -->
            {{ form.hidden_tag() }}
            <div class="mb-3">
                {{ form.template.label(class="form-label") }}
                {{ render_editor(form.template, 'html')}}
            </div>
            <!-- Кнопка отправки формы -->
            <button type="submit" class="btn btn-primary">Submit</button>
            <a href="Objects" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
    <div class="tab-pane fade" id="tools" role="tabpanel" aria-labelledby="tools-tab">
        <a href="../api/export/class/{{id}}" class="btn btn-primary btn-sm" role="button">Export class</a>
        <a href="../api/export/class_all/{{id}}" class="btn btn-primary btn-sm" role="button">Export class and objects</a>
    </div>
</div>
{% endblock %}